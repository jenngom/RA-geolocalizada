<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RA Geolocalizada - Detección de Manos</title>
    <script src="https://cdn.jsdelivr.net/npm/handtrackjs@0.0.3/dist/handtrack.min.js"></script> <!-- Incluir handtrack.js -->
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://cdn.rawgit.com/jeromeetienne/ar.js/2.2.1/aframe/build/aframe-ar.min.js"></script>
</head>
<body style="margin: 0; overflow: hidden;">
    <a-scene embedded arjs="sourceType: webcam; debugUIEnabled: false; trackingMethod: best;">
        <!-- Cámara y escenas de AR -->
        <a-camera gps-camera="minAccuracy: 50;"></a-camera>
        
        <!-- Elemento de texto para mostrar coordenadas -->
        <a-text id="coordinatesText" value="Coordenadas: No detectado" position="0 2 -5" scale="3 3 3"></a-text>
    </a-scene>

    <script>
        let model = null;
        const coordinatesText = document.getElementById('coordinatesText');

        // Cargar el modelo de detección de manos
        handTrack.load().then(function (loadedModel) {
            model = loadedModel;
            console.log('Modelo de detección de manos cargado');
            startDetection();
        });

        // Iniciar la detección de manos
        function startDetection() {
            const video = document.createElement('video');
            document.body.append(video);
            video.width = 640; // Aumenta la resolución
            video.height = 480; // Aumenta la resolución
            
            // Obtener video de la cámara
            navigator.mediaDevices.getUserMedia({ video: { width: 640, height: 480 } }).then(function (stream) {
                video.srcObject = stream;
                video.play();

                // Iniciar el loop de detección de manos
                detectHands(video);
            }).catch(err => {
                console.error('Error al acceder a la cámara:', err);
                alert('No se puede acceder a la cámara.');
            });
        }

        // Detectar las manos y actualizar coordenadas
        function detectHands(video) {
            model.detect(video).then(function (predictions) {
                // Si se detecta una mano, mostrar las coordenadas de la mano
                if (predictions.length > 0) {
                    const hand = predictions[0]; // Tomamos la primera mano detectada
                    const x = hand.bbox[0] + hand.bbox[2] / 2; // Coordenada X central de la mano
                    const y = hand.bbox[1] + hand.bbox[3] / 2; // Coordenada Y central de la mano

                    console.log(`Mano detectada en: X: ${x}, Y: ${y}`);

                    // Mostrar las coordenadas en la escena 3D
                    coordinatesText.setAttribute('value', `Coordenadas de la mano: X: ${x}, Y: ${y}`);
                } else {
                    coordinatesText.setAttribute('value', 'No se detectó ninguna mano');
                }
                
                // Continuar el ciclo de detección
                requestAnimationFrame(() => detectHands(video));
            });
        }
    </script>
</body>
</html>
